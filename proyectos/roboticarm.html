<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" sizes="32x32" href="../Images/LOGO.png">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
  <title>Proyectos - Santiago Bartolomé Romero Vila</title>

  <style>
    :root {
      --bg-color: #f2f2f2;
      --text-color: #333;
      --card-bg: #ffffff;
      --header-bg: linear-gradient(90deg, #0f2027, #203a43, #2c5364);
      --nav-bg: #2c5364;
      --footer-bg: #0f2027;
      --link-bg: #0077b5;
      --link-hover: #005582;
    }

    body.dark-mode {
      --bg-color: #121212;
      --text-color: #e0e0e0;
      --card-bg: #1e1e1e;
      --header-bg: linear-gradient(90deg, #1a1a1a, #2c2c2c, #3b3b3b);
      --nav-bg: #1f1f1f;
      --footer-bg: #000000;
      --link-bg: #005582;
      --link-hover: #003f63;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    header {
      background: var(--header-bg);
      color: white;
      padding: 30px 20px 10px 20px;
      position: relative;
    }

    header h1 a {
      font-size: 1.5rem;
      color: white;
      text-decoration: none;
      transition: color 0.3s;
    }

    section h3 {
      font-size: 1.7rem;
      text-decoration: none;
    }
    
    section h4 {
      font-size: 1.3rem;
      text-decoration: none;
    }

    section h5 {
      font-size: 1rem;
      text-decoration: none;
    }

    .profile2 {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .profile2 .image1 {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 50%;
      border: 2px solid white;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }

    .profile2 .info {
      max-width: 700px;
    }

    .titulo-centrado {
      text-align: center;
      font-size: 1.3em;
      margin: 20px 0 10px;
    }

    #modeToggle {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 1.5em;
      background: transparent;
      border: none;
      padding: 0em 0em;
      border-radius: 0px;
      cursor: pointer;
      z-index: 1000;
      transition: background 0.3s;
    }

    #modeToggle:hover {
      /* Aumenta el tamaño un 10% */
      transition: transform 0.8s;
     transform: scale(1.2);
    }

    nav {
      background-color: var(--nav-bg);
      display: flex;
      justify-content: center;
      gap: 30px;
      padding: 15px;
    }

    nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      transition: color 0.3s;
    }

    nav a::after {
      content: "";
      display: block;
      width: 0;
      height: 2px;
      background: #fff;
      transition: width 0.3s;
    }

    nav a:hover::after {
      width: 100%;
    }

    section {
      max-width: 1000px;
      margin: auto;
      padding: 40px 20px;
    }

    .project {
      background-color: var(--card-bg);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      text-decoration: none;
      display: block;
      color: inherit;
    }

    .project:hover {
      background-color: rgba(0,0,0,0.05);
    }

    .project h3 {
      margin-top: 0;
      color: #2c5364;
    }

    .project p {
      margin: 10px 0;
    }

    footer {
      background-color: var(--footer-bg);
      color: white;
      text-align: center;
      padding: 20px;
      margin-top: 30px;
    }

    footer a {
      color: white;
    }

    .no-estilo {
      text-decoration: none;
      color: inherit;
    }

    .icon-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
    }

    .icon {
      width: 36px;
      height: 36px;
      transition: transform 0.2s;
      border-radius: 10px;
    }

    .icon:hover {
      transform: scale(1.1);
    }

    .icon-dark {
      display: none;
    }

    body.dark-mode .icon-light {
      display: none;
    }

    body.dark-mode .icon-dark {
      display: inline;
    }

    .meta-info {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  font-size: 14px;
}
    .image {
      width: 400px;
      height: 400px;
      transition: transform 0.2s;
      border-radius: 10px;
    }

    .image1 {
      width: 400px;
      height: 300px;
      transition: transform 0.2s;
      border-radius: 10px;
    }

  </style>


<!--BOTON COPIAR CODIGO-->
<style>

.code-container {
  position: relative;
  margin-bottom: 20px;
}

.copy-button {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #444;
  color: white;
  border: none;
  padding: 5px 8px;
  border-radius: 5px;
  cursor: pointer;
  font-size: 0.9em;
  opacity: 0.8;
  transition: 0.3s;
}

.copy-button:hover {
  opacity: 1;
  transform: scale(1.1);
}



































    


   #languageToggle {
      position: absolute;
      top: 20px;
      right: 70px;
      font-size: 1.5em;
      background: transparent;
      border: none;
      padding: 0em 0em;
      border-radius: 0px;
      cursor: pointer;
      z-index: 1000;
      transition: background 0.3s;
    }


  #languageToggle {
    position: absolute;
    top: 20px;
    right: 70px;
  
  }

  #languageToggle:hover {
      /* Aumenta el tamaño un 10% */
    transition: transform 0.8s;
    transform: scale(1.2);
  }

  

.profile2 .image2 {
  
  margin-top:6px;
  width: 30px;
  height: 20px;
  object-fit: cover;
  border: 1px solid black;
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
}




  </style>
</head>










<script defer>
    const translations = {
      es: {
        title1: "Currículum",
        nave1: "Inicio",
        nave2: "Currículum",
        nave3: "Proyectos",
        nave4: "Trabajos",
        nave5: "Prensa",
        title3: "Currículum",
        bod1: "Formación Académica",
        bod2: "Grado en Ingeniería Industrial – Universidad Politécnica de Madrid (2017 – 2025)",
        bod3: "Máster en Automatización y Robótica – Universidad de Stuttgart (2025 – 2026)",
        bod4: "Experiencia Profesional",
        bod5: "Ingeniero de Automatización – Siemens AG (2021 – Actualidad)",
        bod6: "Técnico de Procesos Industriales – Repsol (2018 – 2019)",
        bod7: "Habilidades Técnicas",
        bod8: "Lenguajes",
        bod9: "Python, C++, HTML, CSS, VHDL",
        bod10: "Automatización",
        bod11: "PLCs, Controladores PID, sensores",
        bod12: "Robótica",
        bod13: "MATLAB, Simulink, Arduino (ESP32) y AVR, control cinemático y dinámico",
        bod14: "Idiomas",
        bod15: "Español",
        bod16: " Nativo",
        bod17: "Gallego",
        bod18: " Nativo",
        bod19: "Inglés",
        bod20: " B2",
        bod21: "Alemán",
        bod22: " A2",
        bod23: "Certificaciones (Enlaces)",
        bod24: "First Certificate in English Nivel B2",
        bod25: "Curso Avanzado de Python (Santander Open Academy)",
        bod26: "Introducción a HTML, CSS y JavaScript (IBM–Coursera)",
        bod27: "CS50: Introducción a la Informática (Harvard)",
        bod28: "Programa de Especialización: Machine Learning (Stanford–Coursera)",
        bod29: "Machine Learning con Python (IBM–Coursera)",
        bod30: "Certificado Profesional en Machine Learning (IBM–Coursera)",
        bod31: "CS50's Introducción a la Inteligencia Artificial con Python (Harvard)",
        bod32: "Uso de Python para la Investigación (Harvard)",
        bod33: "Ciencia de Datos: Machine Learning (Harvard)"

      },

      en: {
        title1:"Curriculum",
        nave1:"Home",
        nave2:"Curriculum",
        nave3:"Projects",
        nave4:"Jobs",
        nave5:"Press",
        title3:"Project",
        bod1:"",
        bod2:"",
        bod3:"",
        bod4:"",
        bod5:"",
        bod6:"",
        bod7:"",
        bod8:"",
        bod9:"",
        bod10:"",
        bod11:"",
        bod12:"",
        bod13:"",
        bod14:"",
        bod15:"",
        bod16:"",
        bod17:"",
        bod18:"",
        bod19:"",
        bod20:"",
        bod21:"",
        bod22:"",
        bod23:"",
        bod24:"",
        bod25:"",
        bod26:"",
        bod27:"",
        bod28:"",
        bod29:"",
        bod30:"",
        bod31:"",
        bod32:"",
        bod33:"",
        bod34:"",
        bod35:"",
        bod36:"",
        bod37:"",
        bod38:"",
        bod39:"",
        bod40:"",
        bod41:"",
        bod42:"",
        bod43:"",
        bod44:"",
        bod45:"",
        bod46:"",
        bod47:"",
        bod48:"",
        bod49:"",
        bod50:"",
        bod51:"",
        bod52:"",
        bod53:"",
        bod54:"",
        bod55:"",
        bod56:"",
        bod57:""


      }
    };

    function setLanguage(lang) {
      localStorage.setItem("lang", lang);
      document.querySelectorAll("[data-key]").forEach(el => {
        const key = el.getAttribute("data-key");
        if (translations[lang][key]) {
          el.textContent = translations[lang][key];
        }
      });

      const toggleBtn = document.getElementById("languageToggle");
      if (toggleBtn) {
  toggleBtn.innerHTML = lang === "es"
    ? '<img src="https://flagcdn.com/w40/gb.png" alt="English"  class="image2">'
    : '<img src="https://flagcdn.com/w40/es.png" alt="Español"  class="image2">';
  }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const currentLang = localStorage.getItem("lang") || "es";
      setLanguage(currentLang);

      const toggleBtn = document.getElementById("languageToggle");
      if (toggleBtn) {
        toggleBtn.addEventListener("click", () => {
          const newLang = localStorage.getItem("lang") === "es" ? "en" : "es";
          setLanguage(newLang);
        });
      }
    });
  </script>





































<body>
  <header>
    <div class="profile2">
      <img src="../Images/yo.jpg" alt="Foto de Santiago Bartolomé Romero Vila" class="image1">
      <div class="info">
        <h1><a href="../SantiagoRomeroVila.html">Santiago Bartolomé Romero Vila</a></h1>
      </div>
      <button id="languageToggle">🌐</button>
      <button id="modeToggle">🌙</button>
    </div>
    <h2 class="titulo-centrado">Projects</h2>
  </header>

  <nav>
    <a href="../SantiagoRomeroVila.html">Home</a>
    <a href="../curriculum.html">Curriculum</a>
    <a href="../proyectos.html">Projects</a>
    <a href="../trabajos.html">Jobs</a>
    <a href="../prensa.html">Press</a>
  </nav>

<header1 class="titulo-centrado">
    <h2>
      <p>
         Design and Control of a Three Degrees of Freedom Robotic Arm </p>
      <p>
         with MATLAB Interface and PID Control on ESP32
      </p>
    </h2>
    <p class="meta-info">
        December, 2024 · 1034 words · Santiago Bartolomé Romero Vila
    </p>

    <!--
    <p><a href="METER AQUI LINK JUGAR ONLINE" target="_blank" rel="noopener noreferrer">Launch the Platform</a></p>
    -->
  
  </header1>

  <main>
     <section>
    <p>
       In this project, developed as part of a university course on automation and robotics, a three-degrees-of-freedom robotic arm was designed
        and built, consisting of one stepper motor and two DC motors with encoders. The main goal was to implement a precise position control 
        system using a distributed control architecture, with an ESP32 as the real-time control unit and a graphical user interface (GUI) 
        developed in MATLAB App Designer. Inverse kinematics, PID control, trajectory monitoring, and error evaluation in Cartesian space were 
        implemented. This work provides a solid technical foundation in embedded programming, control of mechatronic systems, and user interface 
        development for robotic applications.

    </p>



      <h3>Introduction</h3>
      <p>The development of robotic systems with multiple degrees of freedom poses significant technical challenges related to motion accuracy, 
        actuator synchronization, and interpretation of user commands. In this project, the team tackled the construction of an articulated 
        robotic arm controlled from MATLAB, aiming to move its end effector to specific positions in 3D space with accuracy and traceability.
        
      </p>

       <h3>System Architecture</h3>
  <p>
   The system is composed of three main subsystems:


  </p>
   <ul>
    <li><strong>Mechanical subsystem:</strong>Articulated robotic arm with two links of known length.</li>
    <li><strong>Embedded control subsystem:</strong> Implemented on an  <strong>ESP32 board,</strong>responsible for motor control and encoder reading.</li>
    <li><strong>User interface subsystem:</strong>Application developed in <strong>MATLAB App Designer</strong>, which calculates trajectories, sends commands, and visualizes results.</li>
  </ul>

   <h3> Actuators and Sensors</h3>
      <h4>Stepper Motor (SM)</h4>
  <p>
   A <strong> bipolar stepper motor</strong> is used to control rotation of the arm in the XY plane. This motor is connected to the ESP32 via direction (dirPin), step (stepPin), and enable (enablePin) pins. Control is carried out by manually generating pulse trains with delayMicroseconds, and step calculation is based on the desired angle, converting degrees to steps using:
  </p>

     <div class="code-container">
  <button class="copy-button">📋</button>
  <pre><code class="language-javascript">
steps = 200; // steps per revolution
stepsDegrees = steps * (angle / 360);
}
  </code></pre>
</div>

      <h4> DC Motors with Encoders</h4>

 <p>Two DC motors control the<strong>height and extension of the arm</strong>. These motors are equipped with <strong>quadrature encoders</strong> for precise position measurement. The encoders are connected to interrupt-enabled pins (attachInterrupt) to record each pulse generated by shaft movement.</p>


       <h4>Speed and Direction Control</h4>

 <p>Speed is controlled via <strong>PWM</strong>, and direction is set using digital pins. Direction reversal logic based on the motor's angular position was implemented to prevent rotation errors when the motor rotates more than 90°.</p>


  <h3>Real-Time PID Control</h3>
  <p>
    Each DC motor is controlled using a <strong>PID algorithm</strong> directly programmed on the ESP32. This control ensures the desired position is reached and maintained despite disturbances or mechanical inaccuracies.


  </p>

  <p>PID calculation includes:</p>

  <ul>
    <li>error = current_position - desired_position</li>
    <li>Derivative and integral of the error</li>
    <li>Anti-windup to avoid excessive integral error accumulation</li>
  </ul>

  <p>
   The implemented code ensures the motor stops if the error is within a <strong>predefined tolerance</strong> (TOLERANCE = 50), to avoid oscillations and overheating.
  </p>

  <h3>Inverse Kinematics and Trajectories</h3>

  <h4>Kinematic Study</h4>
  <p>An  <strong>inverse kinematics model</strong> was implemented for the robotic arm based on its dimensions (L2 = 12 cm, L3 = 15 cm). The model follows a modified SCARA-type manipulator structure and converts desired Cartesian coordinates (Px, Py, Pz) into motor angles:</p>
  <ul>
    <li>q1: stepper motor angle (base)</li>
    <li>q2 and q3: DC motor angles (height and extension)</li>
  </ul>

  <p>The solution is based on formulas derived from geometry and inverse trigonometry:</p>

     <div class="code-container">
  <button class="copy-button">📋</button>
  <pre><code class="language-javascript">

k = (px^2 + py^2 + pz^2 - L2^2 - L3^2) / (2 * L2 * L3);
q1 = atan2(py, px);
q3 = atan2(sqrt(1 - k^2), k);
q2 = atan2(pz, sqrt(px^2 + py^2)) - atan2(L3 * sin(q3), L2 + L3 * cos(q3));

}
  </code></pre>
</div>

  <p>
    Trajectories of  <strong>21 equidistant points</strong> in Cartesian space are generated and then converted into angle sequences for each motor.
  </p>

  <h4>Angle to Pulse Conversion</h4>

     <p>Angles are converted to pulses for the DC motors using:</p>

     <div class="code-container">
  <button class="copy-button">📋</button>
  <pre><code class="language-javascript">

pulse = round((Maxpulse * angle) / 360.0);


  </code></pre>
</div>

  <p>
   This conversion is key for aligning commands from MATLAB with the embedded control system.
  </p>


  
  <h3>MATLAB User Interface (HMI)</h3>

   <p>
   The graphical application developed in MATLAB App Designer allows:
  </p>

  <ul>
    <li>Input of target coordinates.</li>
    <li>Start/stop communication with the ESP32.</li>
    <li>Sending trajectories and visualizing execution.</li>
    <li>Verifying if the point is within the workspace (ellipsoid with safety conditions).</li>
    <li>Displaying current position received from the robot.</li>
  </ul>

  <h4>Workspace Validation</h4>
  <p>
    Before moving the arm, the system checks whether the input point is valid using a truncated ellipsoid inclusion function:
  </p>

  
     <div class="code-container">
  <button class="copy-button">📋</button>
  <pre><code class="language-javascript">

(Px^2 / a^2) + (Pz^2 / b^2) + (Py^2 / c^2) > 1   

  </code></pre>
</div>

  <p>
    This restriction ensures the robot’s integrity and prevents impossible movements.
  </p>


  <h3>Graphs and Error Analysis</h3>
  <p>
   One of the system’s most useful features is the generation of 3D plots comparing:
  </p>

  <ul>
    <li>Desired trajectory (green).</li>
    <li>Actual executed trajectory (dotted red).</li>
    <li>Point-by-point error (color-coded dots).</li>
  </ul>

  <p>
    Euclidean error between the desired and actual trajectories is calculated to experimentally validate system accuracy:
  </p>
  
   <div class="code-container">
  <button class="copy-button">📋</button>
  <pre><code class="language-javascript">

error = sqrt(sum((desired_trajectory - actual_trajectory).^2, 2));
scatter3(..., error, 'filled');


  </code></pre>
</div>

<p>This visualization provides a powerful tool for debugging and improving the control system.</p>

<h3>Results and Learnings</h3>

<h4>Achieved Results</h4>

  <ul>

    <li>Functional and robust control of a 3-DOF robotic arm.</li>
    <li>Effective MATLAB–ESP32 communication established.</li>
    <li>MATLAB interface allows intuitive control and clear visualization.</li>
    <li>The system maintains generally low error (< 1 cm), suitable for educational and prototyping applications.</li>

  </ul>

<h4>Key Learnings</h4>

<h5>Stepper Motors vs. DC Motors</h5>

 <ul>

    <li>Stepper: Step-precision, ideal for base rotation. Easy to control without encoder, but requires care to avoid missed steps.</li>
    <li>DC with encoder: Requires PID control, but offers smoother motion, higher power, and direct feedback.</li>

  </ul>

<h5>PID Control</h5>

 <ul>

    <li>Tuning kp, ki, kd is critical. Anti-windup is important.</li>
    <li>Implementing PID directly on the microcontroller allows real-time and fast response.</li>

  </ul>


<h5>MATLAB App Designer</h5>

 <ul>

    <li>Powerful tool for building graphical interfaces.</li>
    <li>Allows abstraction of complex commands with user-friendly design.</li>
    <li>Robust and fast serial integration.</li>

  </ul>


<h3>Conclusion</h3>

<p>This project enabled the integration of hardware, control, and software into a complete educational robotic solution. Through tools like the ESP32, MATLAB, and automatic control knowledge, a functional system was achieved that solves inverse kinematics, executes trajectories, and measures errors—all in an accessible and modular platform.</p>

<p>The team worked collaboratively to address technical challenges, adapt solutions, and thoroughly document each phase. The result not only meets academic goals but also serves as a solid foundation for future extensions, such as vision-based closed-loop control, force sensor integration, or autonomous trajectory generation.</p>


  <p> All the code can be found in my <a href="https://github.com/Santiagoromerovila/Articulated-Robotic-Arm-Arduino-Matlab-" target="blank" rel="noopener noreferrer">Github</a>. </p>

  <h3>Showcase</h3>
    <img class="image1" src="roboticarm/Interfaz.png" alt="Interface">
     <img class="image" src="roboticarm/Trayectoria.png" alt="Theorical Trayectory vs Real Trayectory">
    </section>
  </main>

  <footer>
    <p>© 2025 <a href="https://www.linkedin.com/in/santiago-bartolom%C3%A9-romero-vila" target="_blank" rel="noopener noreferrer">Santiago Bartolomé Romero Vila</a></p>
    <div class="icon-links">
      <a href="https://www.linkedin.com/in/santiago-bartolom%C3%A9-romero-vila" target="_blank" rel="noopener noreferrer">
        <img class="icon icon-light" src="../Images/link bien.jpg" alt="LinkedIn">
        <img class="icon icon-dark" src="../Images/link black bien.jpg" alt="LinkedIn">
      </a>
      <a href="mailto:santiago.romero.vila@gmail.com">
        <img class="icon icon-light" src="../Images/email lu.jfif" alt="Correo">
        <img class="icon icon-dark" src="../Images/email bla bien.jpg" alt="Correo">
      </a>
      <a href="https://github.com/Santiagoromerovila" target="_blank" rel="noopener noreferrer">
        <img class="icon icon-light" src="../Images/git white.jpeg" alt="Github">
        <img class="icon icon-dark" src="../Images/git black.jpeg" alt="Github">
      </a>
    </div>
  </footer>

  <script>
    const toggleButton = document.getElementById('modeToggle');

    function setMode(mode) {
      if (mode === 'dark') {
        document.body.classList.add('dark-mode');
        toggleButton.textContent = '☀️';
      } else {
        document.body.classList.remove('dark-mode');
        toggleButton.textContent = '🌙';
      }
    }

    const storedMode = localStorage.getItem('theme');
    if (storedMode) setMode(storedMode);

    toggleButton.addEventListener('click', () => {
      const isDark = document.body.classList.toggle('dark-mode');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      toggleButton.textContent = isDark ? '☀️' : '🌙';
    });
  </script>


  <script>
  document.querySelectorAll('.copy-button').forEach(button => {
    button.addEventListener('click', () => {
      const code = button.nextElementSibling.querySelector('code').innerText;
      navigator.clipboard.writeText(code).then(() => {
        button.textContent = '✅ Copiado';
        setTimeout(() => button.textContent = '📋', 2000);
      });
    });
  });
</script>


</body>
</html>
